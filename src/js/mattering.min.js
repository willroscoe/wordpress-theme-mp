!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(jQuery)}(function(g){var n=/\+/g;function f(e){return v.raw?e:encodeURIComponent(e)}function m(e,t){var i=v.raw?e:function(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(n," ")),v.json?JSON.parse(e):e}catch(e){}}(e);return g.isFunction(t)?t(i):i}var v=g.cookie=function(e,t,i){if(1<arguments.length&&!g.isFunction(t)){if("number"==typeof(i=g.extend({},v.defaults,i)).expires){var n=i.expires,o=i.expires=new Date;o.setTime(+o+864e5*n)}return document.cookie=[f(e),"=",(a=t,f(v.json?JSON.stringify(a):String(a))),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var a,r,s=e?void 0:{},h=document.cookie?document.cookie.split("; "):[],c=0,l=h.length;c<l;c++){var d=h[c].split("="),u=(r=d.shift(),v.raw?r:decodeURIComponent(r)),p=d.join("=");if(e&&e===u){s=m(p,t);break}e||void 0===(p=m(p))||(s[u]=p)}return s};v.defaults={},g.removeCookie=function(e,t){return void 0!==g.cookie(e)&&(g.cookie(e,"",g.extend({},t,{expires:-1})),!g.cookie(e))}}),function(l,h,c){var d,u,p,g,f,m,v,w,x,y,b,k,C,T,a,_,r,s,P,R,W,H,I,E,L,M,S,j,D,F,O,B,n,o={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,rel:function(){return this.rel},href:function(){return l(this).attr("href")},title:function(){return this.title}},K="colorbox",q="cbox",A=q+"Element",N=q+"_open",U=q+"_load",$=q+"_complete",z=q+"_cleanup",Q=q+"_closed",J=q+"_purge",G=l("<a/>"),Z="div",V=0,X={};function Y(e,t,i){var n=h.createElement(e);return t&&(n.id=q+t),i&&(n.style.cssText=i),l(n)}function ee(){return c.innerHeight?c.innerHeight:l(c).height()}function te(e,i){i!==Object(i)&&(i={}),this.cache={},this.el=e,this.value=function(e){var t;return void 0===this.cache[e]&&(void 0!==(t=l(this.el).attr("data-cbox-"+e))?this.cache[e]=t:void 0!==i[e]?this.cache[e]=i[e]:void 0!==o[e]&&(this.cache[e]=o[e])),this.cache[e]},this.get=function(e){var t=this.value(e);return l.isFunction(t)?t.call(this.el,this):t}}function ie(e){var t=x.length,i=(M+e)%t;return i<0?t+i:i}function ne(e,t){return Math.round((/%/.test(e)?("x"===t?y.width():ee())/100:1)*parseInt(e,10))}function oe(e,t){return e.get("photo")||e.get("photoRegex").test(t)}function ae(e,t){return e.get("retinaUrl")&&1<c.devicePixelRatio?t.replace(e.get("photoRegex"),e.get("retinaSuffix")):t}function re(e){"contains"in u[0]&&!u[0].contains(e.target)&&e.target!==d[0]&&(e.stopPropagation(),u.focus())}function se(e){se.str!==e&&(u.add(d).removeClass(se.str).addClass(e),se.str=e)}function he(e){l(h).trigger(e),G.triggerHandler(e)}var ce=function(){var e,t,i=q+"Slideshow_",n="click."+q;function o(){clearTimeout(t)}function a(){(W.get("loop")||x[M+1])&&(o(),t=setTimeout(B.next,W.get("slideshowSpeed")))}function r(){_.html(W.get("slideshowStop")).unbind(n).one(n,s),G.bind($,a).bind(U,o),u.removeClass(i+"off").addClass(i+"on")}function s(){o(),G.unbind($,a).unbind(U,o),_.html(W.get("slideshowStart")).unbind(n).one(n,function(){B.next(),r()}),u.removeClass(i+"on").addClass(i+"off")}function h(){e=!1,_.hide(),o(),G.unbind($,a).unbind(U,o),u.removeClass(i+"off "+i+"on")}return function(){e?W.get("slideshow")||(G.unbind(z,h),h()):W.get("slideshow")&&x[1]&&(e=!0,G.one(z,h),W.get("slideshowAuto")?r():s(),_.show())}}();function le(e){var t,i;if(!F){if(t=l(e).data(K),W=new te(e,t),i=W.get("rel"),M=0,i&&!1!==i&&"nofollow"!==i?(x=l("."+A).filter(function(){return new te(this,l.data(this,K)).get("rel")===i}),-1===(M=x.index(W.el))&&(x=x.add(W.el),M=x.length-1)):x=l(W.el),!j){j=D=!0,se(W.get("className")),u.css({visibility:"hidden",display:"block",opacity:""}),b=Y(Z,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden"),g.css({width:"",height:""}).append(b),H=f.height()+w.height()+g.outerHeight(!0)-g.height(),I=m.width()+v.width()+g.outerWidth(!0)-g.width(),E=b.outerHeight(!0),L=b.outerWidth(!0);var n=ne(W.get("initialWidth"),"x"),o=ne(W.get("initialHeight"),"y"),a=W.get("maxWidth"),r=W.get("maxHeight");W.w=(!1!==a?Math.min(n,ne(a,"x")):n)-L-I,W.h=(!1!==r?Math.min(o,ne(r,"y")):o)-E-H,b.css({width:"",height:W.h}),B.position(),he(N),W.get("onOpen"),R.add(T).hide(),u.focus(),W.get("trapFocus")&&h.addEventListener&&(h.addEventListener("focus",re,!0),G.one(Q,function(){h.removeEventListener("focus",re,!0)})),W.get("returnFocus")&&G.one(Q,function(){l(W.el).focus()})}var s=parseFloat(W.get("opacity"));d.css({opacity:s==s?s:"",cursor:W.get("overlayClose")?"pointer":"",visibility:"visible"}).show(),W.get("closeButton")?P.html(W.get("close")).appendTo(g):P.appendTo("<div/>"),function(){var e,t,i,n=B.prep,o=++V;S=!(D=!0),he(J),he(U),W.get("onLoad"),W.h=W.get("height")?ne(W.get("height"),"y")-E-H:W.get("innerHeight")&&ne(W.get("innerHeight"),"y"),W.w=W.get("width")?ne(W.get("width"),"x")-L-I:W.get("innerWidth")&&ne(W.get("innerWidth"),"x"),W.mw=W.w,W.mh=W.h,W.get("maxWidth")&&(W.mw=ne(W.get("maxWidth"),"x")-L-I,W.mw=W.w&&W.w<W.mw?W.w:W.mw);W.get("maxHeight")&&(W.mh=ne(W.get("maxHeight"),"y")-E-H,W.mh=W.h&&W.h<W.mh?W.h:W.mh);if(e=W.get("href"),O=setTimeout(function(){C.show()},100),W.get("inline")){var a=l(e);i=l("<div>").hide().insertBefore(a),G.one(J,function(){i.replaceWith(a)}),n(a)}else W.get("iframe")?n(" "):W.get("html")?n(W.get("html")):oe(W,e)?(e=ae(W,e),S=new Image,l(S).addClass(q+"Photo").bind("error",function(){n(Y(Z,"Error").html(W.get("imgError")))}).one("load",function(){o===V&&setTimeout(function(){var e;l.each(["alt","longdesc","aria-describedby"],function(e,t){var i=l(W.el).attr(t)||l(W.el).attr("data-"+t);i&&S.setAttribute(t,i)}),W.get("retinaImage")&&1<c.devicePixelRatio&&(S.height=S.height/c.devicePixelRatio,S.width=S.width/c.devicePixelRatio),W.get("scalePhotos")&&(t=function(){S.height-=S.height*e,S.width-=S.width*e},W.mw&&S.width>W.mw&&(e=(S.width-W.mw)/S.width,t()),W.mh&&S.height>W.mh&&(e=(S.height-W.mh)/S.height,t())),W.h&&(S.style.marginTop=Math.max(W.mh-S.height,0)/2+"px"),x[1]&&(W.get("loop")||x[M+1])&&(S.style.cursor="pointer",S.onclick=function(){B.next()}),S.style.width=S.width+"px",S.style.height=S.height+"px",n(S)},1)}),S.src=e):e&&k.load(e,W.get("data"),function(e,t){o===V&&n("error"===t?Y(Z,"Error").html(W.get("xhrError")):l(this).contents())})}()}}function de(){u||(n=!1,y=l(c),u=Y(Z).attr({id:K,class:!1===l.support.opacity?q+"IE":"",role:"dialog",tabindex:"-1"}).hide(),d=Y(Z,"Overlay").hide(),C=l([Y(Z,"LoadingOverlay")[0],Y(Z,"LoadingGraphic")[0]]),p=Y(Z,"Wrapper"),g=Y(Z,"Content").append(T=Y(Z,"Title"),a=Y(Z,"Current"),s=l('<button type="button"/>').attr({id:q+"Previous"}),r=l('<button type="button"/>').attr({id:q+"Next"}),_=Y("button","Slideshow"),C),P=l('<button type="button"/>').attr({id:q+"Close"}),p.append(Y(Z).append(Y(Z,"TopLeft"),f=Y(Z,"TopCenter"),Y(Z,"TopRight")),Y(Z,!1,"clear:left").append(m=Y(Z,"MiddleLeft"),g,v=Y(Z,"MiddleRight")),Y(Z,!1,"clear:left").append(Y(Z,"BottomLeft"),w=Y(Z,"BottomCenter"),Y(Z,"BottomRight"))).find("div div").css({float:"left"}),k=Y(Z,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),R=r.add(s).add(a).add(_)),h.body&&!u.parent().length&&l(h.body).append(d,u.append(p,k))}l[K]||(l(de),(B=l.fn[K]=l[K]=function(t,e){var i=this;if(t=t||{},l.isFunction(i))i=l("<a/>"),t.open=!0;else if(!i[0])return i;return i[0]&&(de(),function(){function e(e){1<e.which||e.shiftKey||e.altKey||e.metaKey||e.ctrlKey||(e.preventDefault(),le(this))}return!!u&&(n||(n=!0,r.click(function(){B.next()}),s.click(function(){B.prev()}),P.click(function(){B.close()}),d.click(function(){W.get("overlayClose")&&B.close()}),l(h).bind("keydown."+q,function(e){var t=e.keyCode;j&&W.get("escKey")&&27===t&&(e.preventDefault(),B.close()),j&&W.get("arrowKey")&&x[1]&&!e.altKey&&(37===t?(e.preventDefault(),s.click()):39===t&&(e.preventDefault(),r.click()))}),l.isFunction(l.fn.on)?l(h).on("click."+q,"."+A,e):l("."+A).live("click."+q,e)),!0)}()&&(e&&(t.onComplete=e),i.each(function(){var e=l.data(this,K)||{};l.data(this,K,l.extend(e,t))}).addClass(A),new te(i[0],t).get("open")&&le(i[0]))),i}).position=function(t,e){var i,n,o,a=0,r=0,s=u.offset();function h(){f[0].style.width=w[0].style.width=g[0].style.width=parseInt(u[0].style.width,10)-I+"px",g[0].style.height=m[0].style.height=v[0].style.height=parseInt(u[0].style.height,10)-H+"px"}if(y.unbind("resize."+q),u.css({top:-9e4,left:-9e4}),n=y.scrollTop(),o=y.scrollLeft(),W.get("fixed")?(s.top-=n,s.left-=o,u.css({position:"fixed"})):(a=n,r=o,u.css({position:"absolute"})),!1!==W.get("right")?r+=Math.max(y.width()-W.w-L-I-ne(W.get("right"),"x"),0):!1!==W.get("left")?r+=ne(W.get("left"),"x"):r+=Math.round(Math.max(y.width()-W.w-L-I,0)/2),!1!==W.get("bottom")?a+=Math.max(ee()-W.h-E-H-ne(W.get("bottom"),"y"),0):!1!==W.get("top")?a+=ne(W.get("top"),"y"):a+=Math.round(Math.max(ee()-W.h-E-H,0)/2),u.css({top:s.top,left:s.left,visibility:"visible"}),p[0].style.width=p[0].style.height="9999px",i={width:W.w+L+I,height:W.h+E+H,top:a,left:r},t){var c=0;l.each(i,function(e){i[e]===X[e]||(c=t)}),t=c}X=i,t||u.css(i),u.dequeue().animate(i,{duration:t||0,complete:function(){h(),D=!1,p[0].style.width=W.w+L+I+"px",p[0].style.height=W.h+E+H+"px",W.get("reposition")&&setTimeout(function(){y.bind("resize."+q,B.position)},1),l.isFunction(e)&&e()},step:h})},B.resize=function(e){var t;j&&((e=e||{}).width&&(W.w=ne(e.width,"x")-L-I),e.innerWidth&&(W.w=ne(e.innerWidth,"x")),b.css({width:W.w}),e.height&&(W.h=ne(e.height,"y")-E-H),e.innerHeight&&(W.h=ne(e.innerHeight,"y")),e.innerHeight||e.height||(t=b.scrollTop(),b.css({height:"auto"}),W.h=b.height()),b.css({height:W.h}),t&&b.scrollTop(t),B.position("none"===W.get("transition")?0:W.get("speed")))},B.prep=function(e){if(j){var t,o="none"===W.get("transition")?0:W.get("speed");b.remove(),(b=Y(Z,"LoadedContent").append(e)).hide().appendTo(k.show()).css({width:(W.w=W.w||b.width(),W.w=W.mw&&W.mw<W.w?W.mw:W.w,W.w),overflow:W.get("scrolling")?"auto":"hidden"}).css({height:(W.h=W.h||b.height(),W.h=W.mh&&W.mh<W.h?W.mh:W.h,W.h)}).prependTo(g),k.hide(),l(S).css({float:"none"}),se(W.get("className")),t=function(){var e,t,i=x.length;function n(){!1===l.support.opacity&&u[0].style.removeAttribute("filter")}j&&(t=function(){clearTimeout(O),C.hide(),he($),W.get("onComplete")},T.html(W.get("title")).show(),b.show(),1<i?("string"==typeof W.get("current")&&a.html(W.get("current").replace("{current}",M+1).replace("{total}",i)).show(),r[W.get("loop")||M<i-1?"show":"hide"]().html(W.get("next")),s[W.get("loop")||M?"show":"hide"]().html(W.get("previous")),ce(),W.get("preloading")&&l.each([ie(-1),ie(1)],function(){var e=x[this],t=new te(e,l.data(e,K)),i=t.get("href");i&&oe(t,i)&&(i=ae(t,i),h.createElement("img").src=i)})):R.hide(),W.get("iframe")?("frameBorder"in(e=h.createElement("iframe"))&&(e.frameBorder=0),"allowTransparency"in e&&(e.allowTransparency="true"),W.get("scrolling")||(e.scrolling="no"),l(e).attr({src:W.get("href"),name:(new Date).getTime(),class:q+"Iframe",allowFullScreen:!0}).one("load",t).appendTo(b),G.one(J,function(){e.src="//about:blank"}),W.get("fastIframe")&&l(e).trigger("load")):t(),"fade"===W.get("transition")?u.fadeTo(o,1,n):n())},"fade"===W.get("transition")?u.fadeTo(o,0,function(){B.position(0,t)}):B.position(o,t)}},B.next=function(){!D&&x[1]&&(W.get("loop")||x[M+1])&&(M=ie(1),le(x[M]))},B.prev=function(){!D&&x[1]&&(W.get("loop")||M)&&(M=ie(-1),le(x[M]))},B.close=function(){j&&!F&&(j=!(F=!0),he(z),W.get("onCleanup"),y.unbind("."+q),d.fadeTo(W.get("fadeOut")||0,0),u.stop().fadeTo(W.get("fadeOut")||0,0,function(){u.hide(),d.hide(),he(J),b.remove(),setTimeout(function(){F=!1,he(Q),W.get("onClosed")},1)}))},B.remove=function(){u&&(u.stop(),l[K].close(),u.stop(!1,!0).remove(),d.remove(),F=!1,u=null,l("."+A).removeData(K).removeClass(A),l(h).unbind("click."+q).unbind("keydown."+q))},B.element=function(){return l(W.el)},B.settings=o)}(jQuery,document,window),function(o){var e,t,i,n,a,r="mattering_donate_action",s="mattering_donate_skip_count";e=".colorbox",t="donate"==o.cookie(r),i=1<o.cookie(s),o(e).each(function(){if(!o(this).hasClass("donate")||!t&&!i){var n={};o.each(o(this).data(),function(e,t){if(0===e.indexOf("colorbox")){var i=e.replace(/([A-Z])/g,"-$1").toLowerCase().replace(/^-/,"");n[i.replace("colorbox-","")]=t}}),o(this).colorbox(n)}}),function(i){function e(e){var t=o("#t3",e).val(),i=o("#amount",e).val(),n=o("input[name=amount]:checked",e).val();0!=t?(i?o("#a3",e).val(i):o("#a3",e).val(n),o("#p3",e).val(1),o("#cmd",e).val("_xclick-subscriptions"),o("#item_name",e).val("Recurring donation to Mattering Press"),o("#ppinfo",e).replaceWith('<small id="ppinfo">Requires a PayPal Account</small>')):(o("#a3",e).val(0),o("#p3",e).val(0),o("#cmd",e).val("_donations"),o("#item_name",e).val("Donation to Mattering Press"),o("#ppinfo",e).replaceWith('<small id="ppinfo">Does Not Require a PayPal Account</small>')),t||(o("#cmd",e).val("_donations"),o("#item_name",e).val("Donation to Mattering Press"),o("#ppinfo",e).replaceWith('<small id="ppinfo">Does Not Require a PayPal Account</small>'))}o("input[name=amount]",i).change(function(){e(i)}),o("#amount",i).change(function(){e(i)}),o("#t3",i).change(function(){e(i)}),o("[data-colorbox-href=#donate-popup]").on("click",function(){var e=o(this).attr("href");o("a#skip",i).attr("href",e).one("click",function(){o("#cboxClose:visible").trigger("click")});var t=o("input[name=return]",i);t.attr("value",t.data("base-return")+"?continue="+encodeURIComponent(e)),o("input[name=cancel_return]",i).attr("value",window.location)}),o("button, input, a",".donation-popup-footer").bind("click",function(){var e=o(this).data("action");if("skip"==e){var t=o.cookie(s)||0;o.cookie(r,e,{expires:1}),o.cookie(s,1+parseInt(t),{expires:1})}else o.cookie(r,e,{expires:180})}),e(i)}("#donate-popup"),n=/\.(pdf|mobi|epub)$/i,a="",null!=o("base").attr("href")&&(a=o("base").attr("href")),o("a").each(function(){var i=o(this).attr("href");i&&i.match(n)&&(i.match(document.domain)||"/"==i[0])&&o(this).on("click",function(){var e=/[.]/.exec(i)?/[^.]+$/.exec(i):void 0,t=i;if(ga("send","event","Download","Click-"+e,{page:t},{nonInteraction:1}),_paq.push(["trackEvent","Download Book",t]),null!=o(this).attr("target")&&"_blank"!=o(this).attr("target").toLowerCase())return setTimeout(function(){location.href=a+i},200),!1})})}(jQuery);